<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/plantillas/defaultTemplate.xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.prime.com.tr/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="titulo">Preselecci&oacute;n de candidatos</ui:define>

    <ui:define name="acciones">
        <p:tab title="Otras acciones">
            <h:panelGrid columns="1">
                <p:commandLink styleClass="opcionMenu textoNormal" value="Cancelar" ajax="true" action="#{reclutamiento$concursos.inicio$action}" update="principalForm:mensajes" onmouseover="this.className='opcionMenu  textonegrita';" onmouseout="this.className='opcionMenu  textonormal';" immediate="true">
                    <p:graphicImage styleClass="ui-icon ui-icon-circle-close" />
                </p:commandLink>
            </h:panelGrid>
        </p:tab>
    </ui:define>

    <ui:define name="contenido">    
        <p:spacer height="20" />

        <p:wizard id="wizarPreseleccion" flowListener="#{reclutamiento$preseleccionAspirante.onFlowListener}">

            <p:tab id="concursoSeleccionado" title="Concursos"  >
                <p:spacer height="20" />
                <h:panelGrid columns="4">
                    <h:outputLabel value=""/>
                    <h:outputLabel value="Fecha inicial"/>
                    <p:calendar id="calFechaInicial"  pattern="dd/MM/yyyy" showOn="button"
                                value="#{reclutamiento$preseleccionAspirante.fechaInicial}" />
                    <p:commandButton value="Buscar" image="buscar" 
                                     update="mensajes, calFechaInicial, calFechaFinal, tablaConcursos" 
                                     action="#{reclutamiento$preseleccionAspirante.buscarConcurso$action()}"/>
                    <h:outputLabel value=""/>
                    <h:outputLabel value="Fecha final"/>
                    <p:calendar id="calFechaFinal" 
                                pattern="dd/MM/yyyy" 
                                value="#{reclutamiento$preseleccionAspirante.fechaFinal}" 
                                showOn="button" />
                </h:panelGrid>
                <p:spacer width="20" />
                <p:dataTable id="tablaConcursos"
                             var="concurso" 
                             value="#{reclutamiento$preseleccionAspirante.listaConcurso}"
                             rows="5" 
                             paginator="true" 
                             emptyMessage="No se han encontrado concursos."
                             binding="#{reclutamiento$preseleccionAspirante.tableConcursos}"
                             paginatorAlwaysVisible="true" 
                             selectionMode="single"
                             rowSelectListener="#{reclutamiento$preseleccionAspirante.onRowSelectConcurso}"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,25,50,100" >
                    <f:facet name="header">
                        <h:outputText value="Concursos"/>
                    </f:facet>

                    <p:column sortBy="#{concurso.concursoPK.codConcurso}">
                        <f:facet name="header">
                            C&oacute;digo
                        </f:facet>
                        <h:outputLabel value="#{concurso.concursoPK.codConcurso}"/>
                    </p:column>

                    <p:column filterBy="#{concurso.nombre}" 
                              filterMatchMode="contains"
                              headerText="Nombre del concurso">
                        <h:outputLabel value="#{concurso.nombre}"/>
                    </p:column> 

                    <p:column sortBy="#{concurso.fechaInicial}">
                        <f:facet name="header">
                            Fecha inicial
                        </f:facet>
                        <h:outputLabel value="#{concurso.fechaInicial}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                    </p:column>    

                    <p:column sortBy="#{concurso.fechaFinal}">
                        <f:facet name="header">
                            Fecha final
                        </f:facet>
                        <h:outputLabel value="#{concurso.fechaFinal}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                    </p:column>         

                    <p:column sortBy="#{concurso.numeroPlazas}">
                        <f:facet name="header">
                            N&uacute;mero de plazas
                        </f:facet>
                        <h:outputLabel value="#{concurso.numeroPlazas}" />
                    </p:column> 

                    <p:column sortBy="#{concurso.puesto.nombre}"
                              filterBy="#{concurso.puesto.nombre}"
                              filterMatchMode="contains">
                        <f:facet name="header">
                            Puesto
                        </f:facet>
                        <h:outputLabel value="#{concurso.puesto.nombre}" />
                    </p:column> 
                </p:dataTable>
                <p:spacer height="20" />
            </p:tab>

            <p:tab id="candidatosSeleccionados" title="Candidatos"  >

                <p:spacer height="20" />
                <p:panel >
                    <h:panelGrid columns="5" >
                        <h:outputLabel value="Concurso Seleccionado: " style="font-weight: bold;" />
                        <h:outputLabel value="${SessionBeanREC.concursoSeleccionado.nombre}" />
                        <h:outputLabel value=""/>
                        <h:outputLabel value="Plazas necesarias: " style="font-weight: bold;" />
                        <h:outputLabel value="${SessionBeanREC.concursoSeleccionado.numeroPlazas}" />

                        <h:outputLabel value="Puesto al que aplica: " style="font-weight: bold;" />
                        <h:outputLabel value="${SessionBeanREC.concursoSeleccionado.puesto.nombre}" />
                        <h:outputLabel value=""/>
                        <h:outputLabel value="" />
                        <h:outputLabel value="" />

                        <h:outputLabel value="Fecha Inicial: " style="font-weight: bold;" />
                        <h:outputLabel value="${SessionBeanREC.concursoSeleccionado.fechaInicial}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                        <h:outputLabel value=""/>
                        <h:outputLabel value="Fecha Final: " style="font-weight: bold;" />
                        <h:outputLabel value="${SessionBeanREC.concursoSeleccionado.fechaFinal}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                    </h:panelGrid>
                </p:panel>
                <p:spacer height="20" />
                <div>                 
                    <div style="display: inline-block;">
                        <p:fieldset legend="Criterios de Perfil" style="height: 406px; width: 264px;" >
                            <p:dataTable id="criteriosSeleccionados" 
                                         var="criterio" 
                                         value="#{SessionBeanREC.concursoSeleccionado.puesto.criteriosXPuestoList}"
                                         selection="#{SessionBeanREC.criteriosSeleccionados}"
                                         rows="5" 
                                         paginator="true" 
                                         update="tableCanSeleccionados"
                                         emptyMessage="No se han encontrado Concursos."
                                         binding="#{reclutamiento$preseleccionAspirante.tableCriterios}"
                                         paginatorAlwaysVisible="true" 
                                         selectionMode="multiple"
                                         onRowSelectUpdate="tableCanSeleccionados"
                                         onRowUnselectUpdate="tableCanSeleccionados"
                                         rowSelectListener="#{reclutamiento$preseleccionAspirante.onRowSelectCriterio}"
                                         rowUnselectListener="#{reclutamiento$preseleccionAspirante.onRowUnSelectCriterio}"
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,25,50,100" >

                                <f:facet name="header">  
                                    Criterios por puesto
                                </f:facet>  

                                <p:column sortBy="#{criterio.criterio1.nombre}" 
                                          filterBy="#{criterio.criterio1.nombre}"
                                          filterMatchMode="contains" >
                                    <h:outputLabel value="#{criterio.criterio1.nombre}" />
                                </p:column>

                            </p:dataTable>
                        </p:fieldset>
                    </div>
                    <p:spacer width="80" />
                    <div style="display: inline-block;" >
                        <p:fieldset legend="Candidatos" style="height: 406px; width: 264px;" >
                            <p:dataTable id="tableCanSeleccionados" 
                                         var="candidato" 
                                         value="#{SessionBeanREC.listaCandidatos}"
                                         selection="#{SessionBeanREC.candidatosSeleccionados}"
                                         rows="5" 
                                         paginator="true" 
                                         update="tableCanSeleccionados"
                                         emptyMessage="No se han encontrado Candidatos."
                                         binding="#{reclutamiento$preseleccionAspirante.tableCandidatos}"
                                         paginatorAlwaysVisible="true" 
                                         selectionMode="multiple"
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,25,50,100" >
                                <f:facet name="header">  
                                    Candidatos
                                </f:facet>  

                                <p:column sortBy="#{candidato.nombreCompleto}" 
                                          filterBy="#{candidato.nombreCompleto}"
                                          filterMatchMode="contains" >
                                    <h:outputLabel value="#{candidato.nombreCompleto}" />
                                </p:column>
                            </p:dataTable>
                        </p:fieldset>
                    </div>
                </div>

                <p:spacer height="20" />
            </p:tab>

            <p:tab id="candidatosPreselect" title="Preseleccionar"  >
                <p:spacer height="20" />
                <p:panel>
                    <p:dataList value="#{SessionBeanREC.candidatosSeleccionados}" var="can" type="ordered" paginator="true" rows="5" effectSpeed="fast"  
                                paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink} {RowsPerPageDropdown}"  
                                rowsPerPageTemplate="5,10,15">
                        <p:graphicImage value="/images/search.png"/>  
                        <h:outputText value="#{can.nombreCompleto}" style="margin-left:10px" />  

                    </p:dataList>

                    <f:facet name="footer" >
                        <p:commandButton value="Guardar Candidatos" ajax="true" action="#{reclutamiento$preseleccionAspirante.aplicarCriterios}" update="wizarPreseleccion, mensajes" />
                    </f:facet>
                </p:panel>
            </p:tab>
        </p:wizard>

        <p:spacer height="20" />

    </ui:define>

</ui:composition>